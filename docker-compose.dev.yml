# version: '3.8'

services:
  app:
    build:
      context: .
      dockerfile: Dockerfile.dev
    ports:
      - "${PORT:-3000}:3000"
    environment:
    
      - NODE_ENV=development
      - PORT=${PORT:-3000}
      
      # Database configuration
      - DATABASE_TYPE=postgresql
      - DATABASE_URL=postgresql://postgres:password@database:5432/reusenet_dev
      - DATABASE_HOST=database
      - DATABASE_PORT=5432
      - DATABASE_NAME=reusenet_dev
      - DATABASE_USERNAME=postgres
      - DATABASE_PASSWORD=password
      
      # Storage configuration
      - STORAGE_PROVIDER=local
      - LOCAL_UPLOAD_PATH=./uploads
      - LOCAL_BASE_URL=http://localhost:3000
      
      # Auth configuration
      - AUTH_PROVIDER=custom
      - JWT_SECRET=dev-secret-key
      - JWT_EXPIRES_IN=24h
      
      # AI configuration
      - AI_PROVIDER=openai
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      
      # Maps configuration
      - MAPS_PROVIDER=google
      - GOOGLE_MAPS_API_KEY=${GOOGLE_MAPS_API_KEY}
      
      # Notification configuration
      - NOTIFICATION_PROVIDER=sendgrid
      - SENDGRID_API_KEY=${SENDGRID_API_KEY}
      - SENDGRID_FROM_EMAIL=dev@reusenet.com
      
      # CORS configuration
      - CORS_ORIGIN=http://localhost:3000,http://localhost:3001,http://localhost:5173
      - CORS_CREDENTIALS=true
    
    volumes:
      - .:/app
      - /app/node_modules
      - uploads_data:/app/uploads
    
    depends_on:
      - database
      - redis
    
    networks:
      - reusenet-network

  database:
    image: postgis/postgis:15-3.3-alpine
    environment:
      - POSTGRES_DB=reusenet_dev
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=password
    
    volumes:
      - postgres_dev_data:/var/lib/postgresql/data
    
    ports:
      - "5432:5432"
    
    networks:
      - reusenet-network

  redis:
    image: redis:7-alpine
    command: redis-server --appendonly yes
    
    volumes:
      - redis_dev_data:/data
    
    ports:
      - "6379:6379"
    
    networks:
      - reusenet-network

volumes:
  postgres_dev_data:
    driver: local
  redis_dev_data:
    driver: local
  uploads_data:
    driver: local

networks:
  reusenet-network:
    driver: bridge